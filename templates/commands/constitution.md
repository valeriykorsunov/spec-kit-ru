---
description: Создание или обновление конституции проекта на основе интерактивного ввода или предоставленных принципов, с обеспечением синхронизации всех зависимых шаблонов.
handoffs: 
  - label: Спецификация сборки (Build Specification)
    agent: speckit.specify
    prompt: Реализуй спецификацию функции на основе обновленной конституции. Я хочу создать...
---

## Ввод пользователя (User Input)

```text
$ARGUMENTS
```

Ты **ОБЯЗАН** учесть ввод пользователя перед продолжением (если он не пуст).

## План действий (Outline)

Ты обновляешь конституцию проекта в файле `/memory/constitution.md`. Этот файл является ШАБЛОНОМ, содержащим токены-заполнители в квадратных скобках (например, `[PROJECT_NAME]`, `[PRINCIPLE_1_NAME]`). Твоя задача: (а) собрать/вывести конкретные значения, (б) точно заполнить шаблон и (в) распространить любые изменения на зависимые артефакты.

Следуй этому потоку выполнения:

1. Загрузи существующий шаблон конституции из `/memory/constitution.md`.
   - Найди каждый токен-заполнитель вида `[ALL_CAPS_IDENTIFIER]`.
   **ВАЖНО**: Пользователю может потребоваться меньше или больше принципов, чем используется в шаблоне. Если указано количество, уважай это — следуй общему шаблону. Обнови документ соответствующим образом.

2. Собери/выведи значения для заполнителей:
   - Если ввод пользователя (беседа) предоставляет значение, используй его.
   - В противном случае выведи его из существующего контекста репозитория (README, документация, предыдущие версии конституции, если они встроены).
   - Для дат управления: `RATIFICATION_DATE` — это дата первоначального принятия (если неизвестна, спроси или пометь как TODO), `LAST_AMENDED_DATE` — это сегодня, если внесены изменения, иначе оставь предыдущую.
   - `CONSTITUTION_VERSION` должна увеличиваться в соответствии с правилами семантического версионирования:
     - MAJOR (Мажорная): Обратно несовместимые удаления или переопределения управления/принципов.
     - MINOR (Минорная): Добавлен новый принцип/раздел или существенно расширено руководство.
     - PATCH (Патч): Уточнения, формулировки, исправление опечаток, несемантические улучшения.
   - Если тип повышения версии неоднозначен, предложи обоснование перед завершением.

3. Подготовь содержимое обновленной конституции:
   - Замени каждый заполнитель конкретным текстом (не должно остаться токенов в скобках, кроме намеренно сохраненных слотов шаблона, которые проект решил пока не определять — явно обоснуй любые оставленные).
   - Сохраняй иерархию заголовков; комментарии можно удалить после замены, если они не добавляют поясняющего руководства.
   - Убедись, что каждый раздел Принципа содержит: краткую строку названия, абзац (или маркированный список), описывающий не подлежащие обсуждению правила, и явное обоснование, если оно неочевидно.
   - Убедись, что раздел Управления (Governance) содержит процедуру внесения поправок, политику версионирования и ожидания по проверке соответствия.

4. Чек-лист распространения согласованности (преобразуй предыдущий чек-лист в активные проверки):
   - Прочитай `/templates/plan-template.md` и убедись, что любые "Проверки Конституции" (Constitution Check) или правила соответствуют обновленным принципам.
   - Прочитай `/templates/spec-template.md` на предмет согласования объема/требований — обнови, если конституция добавляет/удаляет обязательные разделы или ограничения.
   - Прочитай `/templates/tasks-template.md` и убедись, что категоризация задач отражает новые или удаленные типы задач, основанные на принципах (например, наблюдаемость, версионирование, дисциплина тестирования).
   - Прочитай каждый командный файл в `/templates/commands/*.md` (включая этот), чтобы убедиться, что не осталось устаревших ссылок (имена, специфичные для агентов, например CLAUDE), когда требуется общее руководство.
   - Прочитай любые документы руководства по выполнению (например, `README.md`, `docs/quickstart.md` или файлы руководства для конкретных агентов, если они есть). Обнови ссылки на измененные принципы.

5. Создай Отчет о влиянии синхронизации (Sync Impact Report) (добавь как HTML-комментарий в начало файла конституции после обновления):
   - Изменение версии: старая → новая
   - Список измененных принципов (старое название → новое название, если переименовано)
   - Добавленные разделы
   - Удаленные разделы
   - Шаблоны, требующие обновления (✅ обновлено / ⚠ ожидается) с путями к файлам
   - TODO для последующих действий, если какие-либо заполнители намеренно отложены.

6. Валидация перед финальным выводом:
   - Нет оставшихся необъясненных токенов в скобках.
   - Строка версии совпадает с отчетом.
   - Даты в формате ISO YYYY-MM-DD.
   - Принципы декларативны, проверяемы и свободны от расплывчатых формулировок ("следует" (should) → замени на MUST/SHOULD с обоснованием, где это уместно).

7. Запиши завершенную конституцию обратно в `/memory/constitution.md` (перезапись).

8. Выведи итоговое резюме пользователю с:
   - Новой версией и обоснованием повышения.
   - Любыми файлами, помеченными для ручного контроля.
   - Предлагаемым сообщением коммита (например, `docs: amend constitution to vX.Y.Z (principle additions + governance update)`).

Требования к форматированию и стилю:

- Используй заголовки Markdown точно так же, как в шаблоне (не понижай/повышай уровни).
- Переноси длинные строки обоснования для сохранения читаемости (идеально <100 символов), но не принуждай к этому жесткими разрывами.
- Оставляй одну пустую строку между разделами.
- Избегай пробелов в конце строк.

Если пользователь предоставляет частичные обновления (например, пересмотр только одного принципа), все равно выполни шаги валидации и принятия решения о версии.

Если критическая информация отсутствует (например, дата ратификации действительно неизвестна), вставь `TODO(<ИМЯ_ПОЛЯ>): объяснение` и включи это в Отчет о влиянии синхронизации в раздел отложенных элементов.

Не создавай новый шаблон; всегда работай с существующим файлом `/memory/constitution.md`.
