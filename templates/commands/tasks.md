---
description: Сгенерируй файл tasks.md с задачами, упорядоченными по зависимостям, для функционала на основе доступных артефактов проектирования.
handoffs: 
  - label: Анализ согласованности
    agent: speckit.analyze
    prompt: Запусти анализ проекта на согласованность
    send: true
  - label: Реализация проекта
    agent: speckit.implement
    prompt: Начни реализацию поэтапно
    send: true
scripts:
  sh: scripts/bash/check-prerequisites.sh --json
  ps: scripts/powershell/check-prerequisites.ps1 -Json
---

## Пользовательский ввод

```text
$ARGUMENTS
```

Ты **ОБЯЗАН** учесть пользовательский ввод перед продолжением (если он не пуст).

## План действий

1. **Настройка**: Запусти `{SCRIPT}` из корня репозитория и разбери `FEATURE_DIR` и список `AVAILABLE_DOCS`. Все пути должны быть абсолютными. Для одиночных кавычек в аргументах, таких как "I'm Groot", используй синтаксис экранирования: например 'I'\''m Groot' (или двойные кавычки, если возможно: "I'm Groot").

2. **Загрузка проектных документов**: Чтение из `FEATURE_DIR`:
   - **Обязательно**: plan.md (технологический стек, библиотеки, структура), spec.md (пользовательские истории с приоритетами)
   - **Опционально**: data-model.md (сущности), contracts/ (API эндпоинты), research.md (решения), quickstart.md (сценарии тестирования)
   - Примечание: Не во всех проектах есть все документы. Генерируй задачи на основе того, что доступно.

3. **Выполнение рабочего процесса генерации задач**:
   - Загрузи plan.md и извлеки технологический стек, библиотеки, структуру проекта
   - Загрузи spec.md и извлеки пользовательские истории с их приоритетами (P1, P2, P3 и т.д.)
   - Если существует data-model.md: Извлеки сущности и сопоставь их с пользовательскими историями
   - Если существует contracts/: Сопоставь эндпоинты с пользовательскими историями
   - Если существует research.md: Извлеки решения для задач настройки
   - Сгенерируй задачи, организованные по пользовательским историям (см. Правила генерации задач ниже)
   - Сгенерируй граф зависимостей, показывающий порядок выполнения пользовательских историй
   - Создай примеры параллельного выполнения для каждой пользовательской истории
   - Проверь полноту задач (каждая пользовательская история имеет все необходимые задачи, независимо тестируема)

4. **Генерация tasks.md**: Используй `templates/tasks-template.md` в качестве структуры, заполни следующим:
   - Правильное название функционала из plan.md
   - Фаза 1: Задачи настройки (инициализация проекта)
   - Фаза 2: Фундаментальные задачи (блокирующие предварительные условия для всех пользовательских историй)
   - Фаза 3+: Одна фаза на пользовательскую историю (в порядке приоритета из spec.md)
   - Каждая фаза включает: цель истории, критерии независимого тестирования, тесты (если запрошены), задачи реализации
   - Финальная фаза: Полировка и сквозные задачи
   - Все задачи должны следовать строгому формату чек-листа (см. Правила генерации задач ниже)
   - Четкие пути к файлам для каждой задачи
   - Раздел зависимостей, показывающий порядок выполнения историй
   - Примеры параллельного выполнения для каждой истории
   - Раздел стратегии реализации (сначала MVP, инкрементальная доставка)

5. **Отчет**: Выведи путь к сгенерированному tasks.md и сводку:
   - Общее количество задач
   - Количество задач на пользовательскую историю
   - Выявленные возможности для параллельного выполнения
   - Критерии независимого тестирования для каждой истории
   - Предлагаемый объем MVP (обычно только Пользовательская история 1)
   - Валидация формата: Подтверди, что ВСЕ задачи следуют формату чек-листа (чекбокс, ID, метки, пути к файлам)

Контекст для генерации задач: {ARGS}

Файл tasks.md должен быть готов к немедленному выполнению - каждая задача должна быть достаточно конкретной, чтобы LLM могла выполнить её без дополнительного контекста.

## Правила генерации задач

**КРИТИЧНО**: Задачи ДОЛЖНЫ быть организованы по пользовательским историям, чтобы обеспечить независимую реализацию и тестирование.

**Тесты ОПЦИОНАЛЬНЫ**: Генерируй задачи по тестированию только если это явно запрошено в спецификации функционала или если пользователь просит подход TDD.

### Формат чек-листа (ОБЯЗАТЕЛЬНО)

Каждая задача ДОЛЖНА строго следовать этому формату:

```text
- [ ] [TaskID] [P?] [Story?] Описание с путем к файлу
```

**Компоненты формата**:

1. **Чекбокс**: ВСЕГДА начинай с `- [ ]` (чекбокс markdown)
2. **ID задачи**: Последовательный номер (T001, T002, T003...) в порядке выполнения
3. **Маркер [P]**: Включай ТОЛЬКО если задача может выполняться параллельно (разные файлы, нет зависимостей от незавершенных задач)
4. **Метка [Story]**: ОБЯЗАТЕЛЬНА только для задач фазы пользовательской истории
   - Формат: [US1], [US2], [US3] и т.д. (соответствует пользовательским историям из spec.md)
   - Фаза настройки: БЕЗ метки истории
   - Фундаментальная фаза: БЕЗ метки истории  
   - Фазы пользовательских историй: ДОЛЖНЫ иметь метку истории
   - Фаза полировки: БЕЗ метки истории
5. **Описание**: Четкое действие с точным путем к файлу

**Примеры**:

- ✅ ПРАВИЛЬНО: `- [ ] T001 Создать структуру проекта согласно плану реализации`
- ✅ ПРАВИЛЬНО: `- [ ] T005 [P] Реализовать middleware аутентификации в src/middleware/auth.py`
- ✅ ПРАВИЛЬНО: `- [ ] T012 [P] [US1] Создать модель User в src/models/user.py`
- ✅ ПРАВИЛЬНО: `- [ ] T014 [US1] Реализовать UserService в src/services/user_service.py`
- ❌ НЕПРАВИЛЬНО: `- [ ] Создать модель User` (отсутствует ID и метка истории)
- ❌ НЕПРАВИЛЬНО: `T001 [US1] Создать модель` (отсутствует чекбокс)
- ❌ НЕПРАВИЛЬНО: `- [ ] [US1] Создать модель User` (отсутствует ID задачи)
- ❌ НЕПРАВИЛЬНО: `- [ ] T001 [US1] Создать модель` (отсутствует путь к файлу)

### Организация задач

1. **Из Пользовательских историй (spec.md)** - ОСНОВНАЯ ОРГАНИЗАЦИЯ:
   - Каждая пользовательская история (P1, P2, P3...) получает свою собственную фазу
   - Сопоставь все связанные компоненты с их историей:
     - Модели, необходимые для этой истории
     - Сервисы, необходимые для этой истории
     - Эндпоинты/UI, необходимые для этой истории
     - Если запрошены тесты: Тесты, специфичные для этой истории
   - Отметь зависимости историй (большинство историй должны быть независимыми)

2. **Из Контрактов**:
   - Сопоставь каждый контракт/эндпоинт → с пользовательской историей, которую он обслуживает
   - Если запрошены тесты: Каждый контракт → задача на тестирование контракта [P] перед реализацией в фазе этой истории

3. **Из Модели Данных**:
   - Сопоставь каждую сущность с пользовательской историей(ями), которым она нужна
   - Если сущность обслуживает несколько историй: Помести в самую раннюю историю или в фазу настройки
   - Связи → задачи сервисного слоя в соответствующей фазе истории

4. **Из Настройки/Инфраструктуры**:
   - Общая инфраструктура → Фаза настройки (Фаза 1)
   - Фундаментальные/блокирующие задачи → Фундаментальная фаза (Фаза 2)
   - Настройка, специфичная для истории → внутри фазы этой истории

### Структура фаз

- **Фаза 1**: Настройка (инициализация проекта)
- **Фаза 2**: Фундаментальная (блокирующие предварительные условия - ДОЛЖНЫ быть завершены до пользовательских историй)
- **Фаза 3+**: Пользовательские истории в порядке приоритета (P1, P2, P3...)
  - Внутри каждой истории: Тесты (если запрошены) → Модели → Сервисы → Эндпоинты → Интеграция
  - Каждая фаза должна быть полным, независимо тестируемым инкрементом
- **Финальная фаза**: Полировка и Сквозные задачи
